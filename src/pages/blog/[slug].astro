---
import Main from "$lib/layout/main-revamp.astro";
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import "$lib/styles/blog.css";
import { render } from "astro:content";
import Toc from "$lib/components/Toc.astro";

export const getStaticPaths = (async () => {
  // Filter out drafts in production
  const collection = await getCollection("blog", (post) => {
    if (!import.meta.env.PROD) {
      return true;
    }

    return post.data.draft !== true;
  });

  return collection.map((post) => ({
    params: { slug: post.id },
    props: {
      slug: post.id,
      post,
      metaDescription: post.data.metaDescription,
    },
  }));
}) satisfies GetStaticPaths;

const { post, metaDescription } = Astro.props;

const { Content, headings } = await render(post);

// We want the date as it's written from the markdown
const dateString = `${post.data.publishedAt.getUTCDate()} ${post.data.publishedAt.toLocaleString("default", { month: "long" })} ${post.data.publishedAt.getUTCFullYear()}`;
---

<Main title={`${post.data.title}`} description={metaDescription}>
  <div class="mt-8 pb-8 blog-content">
    <h1>{post.data.title}</h1>
    <p>Published {dateString}</p>
    <Toc headings={headings} />
    <Content />
  </div>
</Main>

<style>
  h1 {
    font-size: 2.5rem;
  }
</style>
